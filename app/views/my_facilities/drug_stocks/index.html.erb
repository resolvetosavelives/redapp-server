<div class="row">
  <div class="col-lg-12">
    <div class="card card-responsive">
      <div>
        <div class="d-flex align-baseline jc-between">
          <h3>
            Drug stock on hand: end of Dec-2020
          </h3>
          <p class="c-grey-dark">
            Last updated: <%= @last_updated_at %>
          </p>
        </div>

        <p class="mb-4">
          <!--a href="#" type="button" class="float-right ml-4 btn btn-sm btn-primary" data-toggle="modal" data-target="#DrugReportModal"><i class="fas fa-plus-circle mr-2"></i> Drug stock report</a-->
          Patient days is calculated by comparing assigned patients against current stock on hand, normalized by
          estimated patients at each step of the hypertension protocol. Hover over cells to see calculation.
        </p>
        <p>

        </p>
      </div>
      <div class="d-flex fw-wrap mb-16px">
        <%= render "shared/size_and_zone_filters" %>
        <div class="dropdown show mb-8px mr-8px">
          <a id="dropdownMenuLink" class="btn btn-sm btn-outline btn-secondary dropdown-toggle" href="#" role="button" data-toggle="dropdown" data-display="static" aria-haspopup="true" aria-expanded="false">
            Dec-2020
          </a>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
            <button class="dropdown-item active" value="" name="size" type="submit" form="query-filters" onclick="$('#selected-size').remove()">
              Dec-2020
            </button>
            <button class="dropdown-item query-filter-size  filter-by-size" value="large" name="size" type="submit" form="query-filters" onclick="$('#selected-size').remove()">
              Nov-2020
            </button>
            <button class="dropdown-item query-filter-size  filter-by-size" value="medium" name="size" type="submit" form="query-filters" onclick="$('#selected-size').remove()">
              Oct-2020
            </button>
            <button class="dropdown-item query-filter-size  filter-by-size" value="small" name="size" type="submit" form="query-filters" onclick="$('#selected-size').remove()">
              Sep-2020
            </button>
            <button class="dropdown-item query-filter-size  filter-by-size" value="community" name="size" type="submit" form="query-filters" onclick="$('#selected-size').remove()">
              Aug-2020
            </button>
          </div>
        </div>
        <div class="d-flex fw-wrap mb-16px">
          <button class="btn btn-sm btn-link dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Download
          </button>
          <div class="dropdown-menu">
            <button type="submit" name="period" value="May-2020" class="dropdown-item" form="query-filters">Download XLS
              for Dec-2020
            </button>
          </div>
        </div>
      </div>

      <table class="mt-4 table table-compact table-responsive-md table-hover analytics-table">
        <colgroup>
          <col>
          <col>
          <col class="table-divider">
          <col>
          <col>
          <col class="table-divider">
          <col>
          <col>
          <col>
          <col class="table-divider">
          <col>
          <col>
          <col class="mobile">
        </colgroup>
        <thead>
        <tr>
          <th colspan="2">
          <th colspan="3">CCB tablets</th>
          <th colspan="4">ARB tablets</th>
          <th colspan="3">Diuretic tablets</th>
        </tr>
        <tr data-sort-method="thead" class="sorts">
          <th class="row-label sort-label" colspan="2" data-sort-default>Facilities</th>
          <th class="row-label sort-label row-medicine" data-sort-method="number" data-sort-column-key="CCB1">Amlodipine<br>5
            mg
          </th>
          <th class="row-label sort-label row-medicine" data-sort-method="number" data-sort-column-key="CCB2">Amlodipine<br>10
            mg
          </th>
          <th class="row-label sort-label" data-sort-method="number" data-sort-column-key="CCB3">Patient<br>days</th>
          <th class="row-label sort-label row-medicine" data-sort-method="number" data-sort-column-key="ARB1">Telmisartin<br>20
            mg
          </th>
          <th class="row-label sort-label row-medicine" data-sort-method="number" data-sort-column-key="ARB2">Telmisartin<br>40
            mg
          </th>
          <th class="row-label sort-label row-medicine" data-sort-method="number" data-sort-column-key="ARB3">Losartan<br>50
            mg
          </th>
          <th class="row-label sort-label" data-sort-method="number" data-sort-column-key="ARB4">Patient<br>days</th>
          <th class="row-label sort-label row-medicine" data-sort-method="number" data-sort-column-key="D1">Hydrochlorothiazide<br>12.5
            mg
          </th>
          <th class="row-label sort-label row-medicine" data-sort-method="number" data-sort-column-key="D2">Hydrochlorothiazide<br>25
            mg
          </th>
          <th class="row-label sort-label" data-sort-method="number" data-sort-column-key="D3">Patient<br>days</th>
          <th class="mobile"></th>
        </tr>
        </thead>
        <tbody>
        <tr class="row-total" data-sort-method="none">
          <td class="type-title" colspan="2" data-html="true" data-toggle="tooltip" data-placement="top" data-trigger="hover focus click" title="" data-original-title="All facilities: 23,489 patients">All</td>
          <td class="type-number">2,089,694</td>
          <td class="type-number">291,000</td>
          <td class="type-percent" data-html="true" data-toggle="tooltip" data-placement="top" data-trigger="hover focus click" data-original-title="<span class='math'>2,089,694</span>Amlodipine 5 mg<br><span class='math'>+291,000*2</span>Amlodipine 10 mg<br><span class='math'>/23,489*1.4</span>Patients<br><span class='math'>=81 days</span>Patient days">
            <em class="bg-yellow">81</em></td>
          <td class="type-number">886,915</td>
          <td class="type-number">1000</td>
          <td class="type-number">128,760</td>
          <td class="type-percent" data-html="true" data-toggle="tooltip" data-placement="top" data-trigger="hover focus click" data-original-title="<span class='math'>886,915</span>Telmisartin 20 mg<br><span class='math'>+1,000,000*2</span>Amlodipine 10 mg<br><span class='math'>+128,760</span>Losartan 50 mg<br><span class='math'>/23,489*0.37</span>Patients<br><span class='math'>=117 days</span>Patient days">
            <em class="bg-green">117</em></td>
          <td class="type-number">228,365</td>
          <td class="type-number">51,270</td>
          <td class="type-percent" data-html="true" data-toggle="tooltip" data-placement="top" data-trigger="hover focus click" data-original-title="<span class='math'>228,365</span>Hydrochl... 12.5 mg<br><span class='math'>+51,270,000</span>Hydrochl... 25 mg<br><span class='math'>/23,489*0.06</span>Patients<br><span class='math'>=198 days</span>Patient days">
            <em class="bg-green">198</em></td>
        </tr>

        <% @facilities.each do |facility| %>
          <tr>
            <td class="type-title" data-html="true" data-toggle="tooltip" data-placement="top" data-trigger="hover focus click" title="" data-original-title="CHC Nectarine: 203 patients">
              <a href="/analytics/facilities/hwc_carambolim_buzruco"> <%= facility.name %> </a></td>
            <td class="text-center">
              <a href="#" data-toggle="modal" data-target=<%= "#DrugReportModal-#{facility.id}" %>><i class="fas fa-plus"></i></a>
              <%= render "form", facility: facility %>
            </td>
            <td class="type-number">700</td>
            <td class="type-number">1,000</td>
            <td class="type-percent" data-html="true" data-toggle="tooltip" data-placement="top" data-trigger="hover focus click" data-original-title="Show tooltip like in first row...">
              <em class="bg-red">10</em></td>
            <td class="type-number">400</td>
            <td class="type-blank"><span>&#8212;</span></td>
            <td class="type-blank"><span>&#8212;</span></td>
            <td class="type-percent" data-html="true" data-toggle="tooltip" data-placement="top" data-trigger="hover focus click" data-original-title="Show tooltip like in first row...">
              <em class="bg-red">5</em></td>
            <td class="type-number">200</td>
            <td class="type-number">200</td>
            <td class="type-percent" data-html="true" data-toggle="tooltip" data-placement="top" data-trigger="hover focus click" data-original-title="Show tooltip like in first row...">
              <em class="bg-orange">33</em></td>
          </tr>
        <% end %>
        </tbody>
      </table>


      <div class="d-flex mt-4">
        <em class="h-12px w-12px mr-8px b-2px bg-red br-6px"></em>
        <p class="fs-12px lh-1 c-grey-dark">
          &lt;30 patients days of stock
        </p>
      </div>
      <div class="d-flex">
        <em class="h-12px w-12px mr-8px b-2px bg-orange br-6px"></em>
        <p class="fs-12px lh-1 c-grey-dark">
          &lt;60 patients days of stock
        </p>
      </div>
      <div class="d-flex">
        <em class="h-12px w-12px mr-8px b-2px bg-yellow br-6px"></em>
        <p class="fs-12px lh-1 c-grey-dark">
          &lt;90 patients days of stock
        </p>
      </div>
    </div>
  </div>
</div>
